<!DOCTYPE html>
<html lang="it">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ottimizzazione logistica</title>
        <style>
            table,
            th,
            td {
                border: 1px solid rgb(0, 0, 0);
                border-collapse: collapse;
            }
        </style>
    </head>
    <body>
        <script>
            function scriviTabella(tabella, element) {
                const elemento = document.getElementById(element);
                let testo = "";
                testo += "<table><tr><th></th>";
                for (let j = 0; j < tabella[0].length - 1; j++) {
                    testo += "<th>D" + (j + 1) + "</th>";
                }
                testo += "<th>TOT</th>";
                testo += "</tr>";
                for (let i = 0; i < tabella.length; i++) {
                    if (i + 1 == tabella.length) {
                        testo += "<tr><th>TOT</th>";
                    } else {
                        testo += "<tr><th>UP" + (i + 1) + "</th>";
                    }
                    for (let j = 0; j < tabella[0].length; j++) {
                        testo += "<td>" + tabella[i][j] + "</td>";
                    }
                    testo += "</tr>";
                }
                testo += "</table>";
                elemento.innerHTML = testo;
                document.body.appendChild(elemento);
            }

            function scriviReport(report, tot, element) {
                const elemento = document.getElementById(element);
                let testo = "";
                let tabella = copiaMatrice(report);
                testo += "<table><tr>";
                for (let i = 0; i < tabella.length; i++) {
                    for (let j = 0; j < tabella[0].length; j++) {
                        testo += "<td>" + tabella[i][j] + "</td>";
                    }
                    testo += "</tr>";
                }
                testo += "</table>";
                elemento.innerHTML = testo;
                document.body.appendChild(elemento);
            }

            function copiaMatrice(matrice) {
                let copia = [];
                for (let i = 0; i < matrice.length; i++) {
                    copia[i] = [...matrice[i]];
                }
                return copia;
            }

            function nordOvest(tabella, element) {
                let table = copiaMatrice(tabella);
                let ultimaRiga = table.pop();
                let tot = ultimaRiga.pop();
                let ultimaColonna = [];
                for (i = 0; i < table.length; i++) {
                    ultimaColonna[i] = table[i].pop();
                }
                console.log(ultimaRiga);
                console.log(ultimaColonna);
                console.log(table);
                let costoTot = 0;
                let riassunto = [];
                let UP = 1;
                let D = 1;
                do {
                    let costoParziale = 0;
                    let quantita = 0;
                    if (ultimaColonna[0] > ultimaRiga[0]) {
                        //modifico il valore maggiore
                        ultimaColonna[0] -= ultimaRiga[0];

                        //inizializzo i valori per creare il riassunto
                        quantita = ultimaRiga[0];
                        costoParziale += table[0][0] * quantita;

                        //cancello la riga
                        ultimaRiga.shift();
                        for (i = 0; i < table.length; i++) {
                            table[i].shift();
                        }
                        //creo la riga del riassunto
                        riassunto[riassunto.length] = [
                            "quantita' = " + quantita,
                            "UP" + UP + "=>D" + D,
                            "costo = " + costoParziale,
                        ];

                        UP++; //"sposto" la riga
                    } else {
                        //modifico il valore maggiore
                        ultimaRiga[0] -= ultimaColonna[0];

                        //inizializzo i valori per creare il riassunto
                        quantita = ultimaColonna[0];
                        costoParziale += table[0][0] * quantita;

                        //cancello la colonna
                        ultimaColonna.shift();
                        table.shift();
                        //creo la riga del riassunto
                        riassunto[riassunto.length] = [
                            "quantita' = " + quantita,
                            "UP" + UP + "=>D" + D,
                            "costo = " + costoParziale,
                        ];

                        D++; //"sposto" la colonna
                    }
                    costoTot += costoParziale; //aggiorno il costo totale

                    console.log(ultimaRiga);
                    console.log(ultimaColonna);
                    console.log(copiaMatrice(table));
                    console.log(costoTot);
                } while (table.length * table[0]?.length > 0);
                console.log(riassunto);
                scriviReport(riassunto, costoTot, element);
            }

            function aggiungiRiga(tabella) {
                let ultimaRiga = tabella.pop();
                let nuovaRiga = [];
                for (let i = 0; i < ultimaRiga.length - 1; i++) {
                    nuovaRiga[i] = 999;
                }
                nuovaRiga[nuovaRiga.length] = totO - totV;
                tabella.push(nuovaRiga);
                tabella.push(ultimaRiga);
            }

            function aggiungiColonna(tabella) {
                for (i = 0; i < tabella.length; i++) {
                    let temp = tabella[i][tabella[i].length - 1];
                    tabella[i][tabella[i].length - 1] = 999;
                    tabella[i][tabella[i].length] = temp;
                }
                tabella[tabella.length - 1][
                    tabella[tabella.length - 1].length - 2
                ] = totV - totO;
            }

            var tot = 0;
            let tabella = [
                [80, 40, 20, 90, 100],
                [150, 130, 20, 30, 200],
                [40, 40, 10, 100, 300],
                [50, 100, 200, 250, 0],
            ];

            let totV = 0;
            for (i = 0; i < tabella.length - 1; i++) {
                totV += tabella[i][tabella[i].length - 1];
            }

            console.log("totV = " + totV + "<br/>");

            let totO = 0;
            for (i = 0; i < tabella[0].length - 1; i++) {
                totO += tabella[tabella.length - 1][i];
            }

            console.log("totO = " + totO + "<br/>");

            if (totO > totV) {
                document.write(
                    "i totali non coincidono<br/>e' stata aggiunta una unita' produttiva fittizia<br/>"
                );
                aggiungiRiga(tabella);
                tot = totO;
            } else if (totV > totO) {
                document.write(
                    "i totali non coincidono<br/>e' stata aggiunta una destinazione fittizia<br/>"
                );
                aggiungiColonna(tabella);
                tot = totV;
            } else tot = totV;

            tabella[tabella.length - 1][tabella[0].length - 1] = tot;
            console.log("il totale e' " + tot + "<br/>");
            console.log(tabella);
        </script>

        <button onclick="scriviTabella(tabella,'tabellaOut')">
            genera tabella
        </button>
        <p id="tabellaOut"></p>

        <button onclick="nordOvest(tabella,'giorgio')">
            metodo nord ovest
        </button>
        <p id="giorgio"></p>
    </body>
</html>
